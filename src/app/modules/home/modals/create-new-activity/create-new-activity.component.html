<ng-template #modalRef let-modal>
  <div class="modal-container">
    <div class="modal-header">
      <h5 class="modal-title">Create new Activity</h5>
      <div type="button" class="close" (click)="modal.close()" aria-label="Close">
        <span aria-hidden="true">×</span>
      </div>
    </div>
    <div class="modal-body">
      <ng-container *ngIf="!saving">
        <div class="row">
          <div class="activity-name-input col-4">
            <input placeholder="Activity Name" [(ngModel)]="activityName" class="form-control integraa-input activity-name-input"/>
          </div>
        </div>

        <div class="actions-container">

          <div class="left"></div>
          <div class="right">
            <div class="new-sub-activity-button-container">
              <button class="btn btn-primary new-sub-activity-button" (click)="addNewSubActivity()" [disabled]="disabled || (subActivities && subActivities.length && !subActivities[subActivities.length - 1].created)">New Sub Activity</button>
            </div>
          </div>

        </div>

        <div class="sub-activities-container container-fluid">
          <div class="sub-activity-header row">
            <div class="col-2 d-flex"><div class="w-100 text-center"><div class="border-bottom-dashed">Operator</div> <div>Saturday Status</div></div> </div>
            <div class="col-4 d-flex"><div class="w-100 text-center"><div class="border-bottom-dashed">Caps</div> <div>Categories</div></div></div>
            <div class="col-1 d-flex"><div class="w-100 text-center"><div class="border-bottom-dashed">Qty per day</div> <div>Total Qty</div></div></div>
            <div class="col-2 d-flex"><div class="w-100 text-center"><div class="border-bottom-dashed">Start Date</div> <div> End Date</div></div></div>
            <div class="col-3 d-flex"><div class="w-100 text-center"><div class="border-bottom-dashed">Postmen</div> <div> Recommended Postmen</div></div></div>
            <!--<div class="col-1 d-flex"><div class="m-auto"></div></div>-->
          </div>
          <ng-container *ngFor="let subActivity of subActivities">
            <!-- Sub activity view {  -->
            <div class="sub-activity-container row z-depth-1" [ngClass]="{'disabled': disabled || (hasConflict && !( subActivity.created && !subActivity.ready )), 'created': subActivity.created, 'not-ready': subActivity.created && !subActivity.ready}">
              <div class="sub-activity-delete" *ngIf="!subActivity.created" (click)="deleteLast()">×</div>

              <div class="col-2">

                <!-- Operator { -->
                <ng-select placeholder="operator" [(ngModel)]="subActivity.operators" [items]="operators" [bindLabel]="'name'"
                           (change)="saveSubActivity(subActivity)" class="integraa-select" [bindValue]="'id'">
                </ng-select>
                <!-- } Operator -->

                <div class="border-bottom-dashed-black"></div>

                <!-- nextSaturdayStatus { -->
                <input type="checkbox" [(ngModel)]="subActivity.nextSaturdayStatus" (change)="saveSubActivity(subActivity)" class="d-block m-auto">
                <!-- } nextSaturdayStatus -->

              </div>

              <div class="col-4">
                <!-- Caps { -->
                <ng-select placeholder="caps" (open)="loadCaps(subActivity)" [loading]="subActivity.isCapsLoading" #capsSelect
                           [ngClass]="{'disabled': !subActivity.operators }"
                           [disabled]="!subActivity.operators" [(ngModel)]="subActivity.caps" [items]="caps"
                           (change)="capsChanged($event, subActivity)" (remove)="capRemoved($event, subActivity)" [bindLabel]="'name'" [clearable]="false" [multiple]="true" class="integraa-select"
                           [bindValue]="'id'" (scrollToEnd)="loadCaps(subActivity, subActivity.capsPage + 1)">
                </ng-select>
                <!-- } Caps -->

                <div class="border-bottom-dashed-black"></div>

                <!-- Categories { -->
                <ng-select placeholder="categories" (open)="loadCategories(subActivity)" [loading]="subActivity.isCategoriesLoading" #categoriesSelect
                           [ngClass]="{'disabled': !subActivity.caps || !subActivity.caps.length || !subActivity.operators}"
                           [disabled]="!subActivity.caps || !subActivity.caps.length || !subActivity.operators"
                           [items]="categories" (change)="categoriesChanged(subActivity)" (remove)="categoryRemoved($event, subActivity)" [bindLabel]="'name'" [(ngModel)]="subActivity.categories"
                           [multiple]="true" class="integraa-select" [bindValue]="'id'" (scrollToEnd)="loadCategories(subActivity, subActivity.categoriesPage + 1)">
                </ng-select>
                <!-- } Categories -->

              </div>

              <div class="col-1">

                <!-- Quantity per day { -->
                <input type="numer"
                       [disabled]="!subActivity.categories || !subActivity.categories.length || !subActivity.caps || !subActivity.caps.length || !subActivity.operators"
                       [(ngModel)]="subActivity.qtyPerDay" (change)="productsPerDayChanged(subActivity)" class="form-control form-control-sm integraa-input text-center" placeholder="quantity per day">
                <!-- } Quantity per day -->

                <div class="border-bottom-dashed-black"></div>

                <!-- Total Quantity { -->
                <div class="total-quantity text-center m-auto">{{subActivity.totalQuantity}}</div>
                <!-- } Total Quantity -->

              </div>

              <div class="col-2">

                <!-- Start Date { -->
                <input type="date"
                       [disabled]="disabled || !subActivity.qtyPerDay || subActivity.qtyPerDay === '0' || !subActivity.categories || !subActivity.categories.length || !subActivity.caps || !subActivity.caps.length  || !subActivity.operators"
                       [(ngModel)]="subActivity.startDate" (change)="startDateChanged(subActivity)" class="form-control form-control-sm integraa-input">
                <!-- } Start Date -->

                <div class="border-bottom-dashed-black"></div>

                <!-- End Date { -->
                <input type="date" disabled [(ngModel)]="subActivity.endDate" class="form-control form-control-sm integraa-input">
                <!-- } End Date -->
              </div>


              <div class="col-3">

                <!-- Postmen { -->
                <ng-select placeholder="postmen"
                           [ngClass]="{'disabled': disabled || !subActivity.startDate || !subActivity.qtyPerDay || subActivity.qtyPerDay === '0' || !subActivity.categories || !subActivity.categories.length || !subActivity.caps || !subActivity.caps.length  || !subActivity.operators}"
                           [disabled]="disabled || !subActivity.startDate || !subActivity.qtyPerDay || subActivity.qtyPerDay === '0' || !subActivity.categories || !subActivity.categories.length || !subActivity.caps || !subActivity.caps.length  || !subActivity.operators"
                           [(ngModel)]="subActivity.postmen" (open)="loadPostmen(subActivity)"
                           [items]="subActivity.postmenList" [bindLabel]="'full_name'" [multiple]="true"
                           (change)="postmenChanged(subActivity)" class="integraa-select" [bindValue]="'id'">
                </ng-select>
                <!-- } Postmen -->
                <div class="border-bottom-dashed-black"></div>
                <!-- Postmen { -->
                <ng-select placeholder="postmen"
                           [ngClass]="{'disabled': disabled || !subActivity.startDate || !subActivity.qtyPerDay || subActivity.qtyPerDay === '0' || !subActivity.categories || !subActivity.categories.length || !subActivity.caps || !subActivity.caps.length  || !subActivity.operators}"
                           [disabled]="disabled || !subActivity.startDate || !subActivity.qtyPerDay || subActivity.qtyPerDay === '0' || !subActivity.categories || !subActivity.categories.length || !subActivity.caps || !subActivity.caps.length  || !subActivity.operators"
                           [(ngModel)]="subActivity.recommendedPostmen"
                           (change)="recommendedPostmenChanged(subActivity)" (open)="loadRecommendedPostmen(subActivity)"
                           [items]="subActivity.recommendedPostmenList" [bindLabel]="'full_name'" [multiple]="true"
                           class="integraa-select" [bindValue]="'id'">
                </ng-select>
                <!-- } Postmen -->
              </div>

              <!--<div class="col-1">-->
              <!--</div>-->
            </div>
            <!-- } Sub activity view -->
          </ng-container>

        </div>

        <div class="actions-container">

          <div class="left"></div>
          <div class="right">
            <div class="new-sub-activity-button-container">
              <button class="btn btn-success new-sub-activity-button" [disabled]="disabled || !subActivities || !subActivities.length || hasConflict || !activityName || anyNotSaved" (click)="saveActivity(modal)">Save Activity</button>
            </div>
          </div>

        </div>
      </ng-container>
      <ng-container *ngIf="saving">
        <div class="d-flex loading-container">
          <div class="lds-ellipsis m-auto"><div></div><div></div><div></div><div></div></div>
        </div>
      </ng-container>
    </div>
  </div>
</ng-template>

