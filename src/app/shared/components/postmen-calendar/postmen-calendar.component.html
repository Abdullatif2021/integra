<ng-container *ngIf="view==='week'">
    <div class="postmen-calender-container">

        <div class="date-value">{{data.date}}</div>

        <div class="calender-table">
            <ng-container *ngFor="let day of data.days; let idx = index">
                <div class="calender-day-col" *ngIf="idx < days.length">
                    <div class="day-name day-row">{{days[idx]}}</div>
                    <div class="day-number day-row">{{day.number}}</div>
                    <div class="day-note day-row d-flex"><div class="note-text">{{day.note}}</div><div class="edit-icon" (click)="openEditDayNoteModal(day, idx)"><fa-icon [icon]="['fa','pen']"></fa-icon></div></div>
                    <div class="day-attachment day-row d-flex"><a class="note-text text-truncate" href="#">{{day.attachment}}</a><div (click)="openEditDayAttachmentModal(day, idx)" class="edit-icon"><fa-icon [icon]="['fa','pen']"></fa-icon></div></div>
                    <div class="day-part revisers-part">
                        <div class="occupied-revisers-sub-part day-sub-part">
                            <ng-container [ngTemplateOutlet]="data_set" [ngTemplateOutletContext]="{data:day.postmen.available,klass:'bg-green', title: 'Postman disponibili'}"></ng-container>
                        </div>
                        <div class="available-revisers-sub-part day-sub-part">
                            <ng-container [ngTemplateOutlet]="data_set" [ngTemplateOutletContext]="{data:day.postmen.occupied,klass:'bg-red', title: 'Postman occupati'}"></ng-container>
                        </div>
                    </div>

                    <div class="day-part postmen-part mt-4">
                        <div class="occupied-postmen-sub-part day-sub-part">
                            <ng-container [ngTemplateOutlet]="data_set" [ngTemplateOutletContext]="{data:day.revisers.available,klass:'bg-green', title: 'Revisori disponibili'}"></ng-container>
                        </div>
                        <div class="available-postmen-sub-part day-sub-part">
                            <ng-container [ngTemplateOutlet]="data_set" [ngTemplateOutletContext]="{data:day.revisers.occupied,klass:'bg-red', title: 'Revisori occupati'}"></ng-container>
                        </div>
                    </div>
                </div>
            </ng-container>
        </div>

    </div>
</ng-container>
<ng-container *ngIf="view==='day'">
    <div class="postmen-calender-container">

        <div class="single-day-header">
            <div class="single-day-date-switch">
                <div class="single-day-date-switch-left" (click)="changeCurrentDay(-1)" [ngClass]="{'disabled-day-change': current_day === 0}"><fa-icon [icon]="['fa', 'chevron-left']"></fa-icon></div>
                <div class="single-day-date-switch-cinter">
                    <div class="single-day-date-value">{{data.days[current_day].date}}</div>
                    <div>{{days[current_day]}}</div>
                </div>
                <div class="single-day-date-switch-right" (click)="changeCurrentDay(1)" [ngClass]="{'disabled-day-change': current_day === 6}"><fa-icon [icon]="['fa', 'chevron-right']"></fa-icon></div>
            </div>
            <div class="single-day-note-text">{{data.days[current_day].note}}</div><div class="edit-icon" (click)="openEditDayNoteModal(data.days[current_day], current_day)"><fa-icon [icon]="['fa','pen']"></fa-icon></div>
            <div class="single-day-attachment"><img src="/assets/images/file_icon.svg"></div>
        </div>

        <div class="d-flex postman-info-content">
            <div [ngClass]="{'full-width-single-day-calender-table': !displayed_postman}" class="single-day-calender-table mt-2">
                <div class="single-day-col">
                    <div class="day-part revisers-part">
                        <div class="occupied-revisers-sub-part day-sub-part">
                            <ng-container [ngTemplateOutlet]="data_set" [ngTemplateOutletContext]="{data:data.days[current_day].postmen.available,klass:'bg-green', title: 'Postman disponibili'}"></ng-container>
                        </div>
                        <div class="available-revisers-sub-part day-sub-part">
                            <ng-container [ngTemplateOutlet]="data_set" [ngTemplateOutletContext]="{data:data.days[current_day].postmen.occupied,klass:'bg-red', title: 'Postman occupati'}"></ng-container>
                        </div>
                    </div>

                    <div class="day-part postmen-part mt-4">
                        <div class="occupied-postmen-sub-part day-sub-part">
                            <ng-container [ngTemplateOutlet]="data_set" [ngTemplateOutletContext]="{data:data.days[current_day].revisers.available,klass:'bg-green', title: 'Revisori disponibili'}"></ng-container>
                        </div>
                        <div class="available-postmen-sub-part day-sub-part">
                            <ng-container [ngTemplateOutlet]="data_set" [ngTemplateOutletContext]="{data:data.days[current_day].revisers.occupied,klass:'bg-red', title: 'Revisori occupati'}"></ng-container>
                        </div>
                    </div>
                </div>
            </div>
            <div  *ngIf="displayed_postman" class="postman-info-table mt-2">
                <div class="postman-info-container">
                    <div class="postman-info-row">
                        <div class="postman-info-label">Distinta</div>
                        <div class="postman-info-value">de-5x8659f896129-1103201911-35208</div>
                    </div>
                    <div class="postman-info-row">
                        <div class="postman-info-label">Data creazione</div>
                        <div class="postman-info-value">15/08/2020</div>
                    </div>
                    <div class="postman-info-row">
                        <div class="postman-info-label">Data lavorazione</div>
                        <div class="postman-info-value">20/08/2020</div>
                    </div>
                    <div class="postman-info-row">
                        <div class="postman-info-label">Postino</div>
                        <div class="postman-info-value">Turco Luca</div>
                    </div>
                    <div class="postman-info-row">
                        <div class="postman-info-label">Quantita prodotti</div>
                        <div class="postman-info-value">200 prodotti</div>
                    </div>
                    <div class="postman-info-row2">
                        <div class="postman-info-label">Specifica Consegna</div>
                        <div class="postman-info-value">
                            <div><span class="show-more-statuses-count" (click)="current_day_info.delivered_expanded = !current_day_info.delivered_expanded"><fa-icon [icon]="['fa', !current_day_info.delivered_expanded ? 'chevron-right' : 'chevron-down']"></fa-icon></span> 20 Consegnati</div>
                            <div class="statuses-counts-collabse pl-4" *ngIf="current_day_info.delivered_expanded">
                                <div>Raccomendate: 5</div>
                                <div>Notiche: 11</div>
                                <div>Posta: 4</div>
                            </div>
                            <div><span class="show-more-statuses-count" (click)="current_day_info.not_delivered_expanded = !current_day_info.not_delivered_expanded"><fa-icon [icon]="['fa', !current_day_info.not_delivered_expanded ? 'chevron-right' : 'chevron-down']"></fa-icon></span> 180 Non Consegnati</div>
                            <div class="statuses-counts-collabse pl-4" *ngIf="current_day_info.not_delivered_expanded">
                                <div>Raccomendate: 30</div>
                                <div>Notiche: 40</div>
                                <div>Posta: 24</div>
                                <div>Massiva: 86</div>
                            </div>
                        </div>
                    </div>
                    <div class="postman-info-row2">
                        <div class="postman-info-label">Specifica Prodotti</div>
                        <div class="postman-info-value">
                            <div>Raccomendate: 10</div>
                            <div>Notiche: 50</div>
                            <div>Posta: 40</div>
                            <div>Massiva: 100</div>
                        </div>
                    </div>
                    <div class="postman-info-row2">
                        <div class="postman-info-label">Specifica Distribuzione</div>
                        <ul class="postman-info-value ml-3">
                            <li>40023 - Imola - Notiche - 10 Prodotti</li>
                            <li>40024 - Imola - Notiche - 50 Prodotti</li>
                            <li>40025 - Imola - Notiche - 40 Prodotti</li>
                            <li>40026 - Imola - Notiche - 100 Prodotti</li>
                        </ul>
                    </div>
                    <div class="postman-info-row2">
                        <div class="postman-info-label">Operatore che prepara la borsa</div>
                        <ng-select class="integraa-select" [bindLabel]="'name'" [items]="[{id:1, name:'Mario Rossi'}, {id:2, name:'Someone Somthing'}]"></ng-select>
                    </div>
                    <div class="postman-info-row2">
                        <div class="postman-info-label">Esito preparazione borsa</div>
                        <ng-select class="integraa-select" [bindLabel]="'name'" [items]="[{id:1, name:'Borsa Pronta alla consegna'}]"></ng-select>
                    </div>
                    <div class="notes postman-info-row2 mt-3">
                        <app-comments title="Note interne"></app-comments>
                    </div>
                    <div class="postman-notifications postman-info-row2 mt-3">
                        <app-comments title="Notifica per postino"></app-comments>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ng-container>

<!-- Templates -->
<ng-template #data_set let-data="data" let-klass="klass" let-title="title">
    <div class="data-set occupied-set">
        <div class="data-set-header">{{title}}</div>
        <div class="data-set-body">
            <ng-container *ngFor="let row of data; let idx = index">
                <div class="data-set-row {{klass}}" (click)="displayedPostman(row)" [ngClass]="{'odd': idx%2, 'even': !(idx%2)}">
                    <div class="d-flex">
                        <div class="postman-icon"><img src="/assets/images/postman-icon.png"></div>
                        <div class="postman-name">{{row.name}}</div>
                        <div class="edit-icon pr-0" (click)="openEditPostmanNoteModal(row)"><fa-icon [icon]="['fa','pen']"></fa-icon></div>
                    </div>
                    <div class="postman-note">{{row.note}}</div>
                </div>
            </ng-container>

        </div>
    </div>
</ng-template>


<!-- Modals -->
<ng-template #editPostmanNoteModal let-modal>

    <div class="modal-container nFoundItemModal">
        <div class="modal-body">
            <h6 class="text-center">
                <fa-icon [icon]="['fa','pen']"></fa-icon> Set Postman ({{activepostman.name}}) Note
            </h6>
            <textarea #postmanNoteInput class="form-control mt-4" placeholder="Note">{{activepostman.note}}</textarea>
            <div class="btns-container mt-3">
                <button type="button" (click)="modal.close();savePostmanNote(postmanNoteInput)" class="integraa-btn ml-2 float-right" >Continua</button>
                <button type="button" (click)="modal.close();" class="integraa-btn ml-2 bg-light float-right" >Annulla</button>
                <div class="clear-both"></div>
            </div>
        </div>
    </div>

</ng-template>
<ng-template #editDayNoteModal let-modal>

    <div class="modal-container nFoundItemModal">
        <div class="modal-body">
            <h6 class="text-center">
                <fa-icon [icon]="['fa','pen']"></fa-icon> Set Day {{activeday._idx}} ({{days[activeday._idx]}}) Note
            </h6>
            <textarea #dayNoteInput class="form-control mt-4" placeholder="Note">{{activeday.note}}</textarea>
            <div class="btns-container mt-3">
                <button type="button" (click)="modal.close();saveDayNote(dayNoteInput)" class="integraa-btn ml-2 float-right" >Continua</button>
                <button type="button" (click)="modal.close();" class="integraa-btn ml-2 bg-light float-right" >Annulla</button>
                <div class="clear-both"></div>
            </div>
        </div>
    </div>

</ng-template>
<ng-template #editDayAttachmentModal let-modal>

    <div class="modal-container nFoundItemModal">
        <div class="modal-body">
            <h6 class="text-center">
                <fa-icon [icon]="['fa','pen']"></fa-icon> Set Day {{activeday._idx}} ({{days[activeday._idx]}}) Attachment
            </h6>
            <ngx-file-drop dropZoneLabel="Drop files here" [dropZoneClassName]="'drop-file-area'" (onFileDrop)="fileSelected($event)">
                <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector">
                    <div>
                        <div class="drop-file-label" *ngIf="!selected_file"> <fa-icon [icon]="['fa', 'upload']"></fa-icon> Drop file here</div>
                        <div class="drop-file-label" *ngIf="selected_file"> {{selected_file.relativePath}} </div>
                        <button type="button" class="select-file-button mt-2" (click)="openFileSelector()">Browse Files</button>
                    </div>
                </ng-template>
            </ngx-file-drop>

            <div class="btns-container mt-3">
                <button type="button" (click)="modal.close();saveDayAttachment()" class="integraa-btn ml-2 float-right" >Continua</button>
                <button type="button" (click)="modal.close();clearSelectedFile()" class="integraa-btn ml-2 bg-light float-right" >Annulla</button>
                <div class="clear-both"></div>
            </div>
        </div>
    </div>

</ng-template>